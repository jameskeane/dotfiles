#!/bin/sh

# Register with gnome-session so that it does not kill the whole session thinking it is dead.
test -n "$DESKTOP_AUTOSTART_ID" && {
  dbus-send --print-reply --session --dest=org.gnome.SessionManager "/org/gnome/SessionManager" org.gnome.SessionManager.RegisterClient "string:dwm-gnome" "string:$DESKTOP_AUTOSTART_ID"
}

_rel=25
while [ $_rel = 25 ]; do
  dwm 2> ~/.local/dwm/stderr.log
  _rel=$?
done

test -n "$DESKTOP_AUTOSTART_ID" && {
  dbus-send --print-reply --session --dest=org.gnome.SessionManager "/org/gnome/SessionManager" org.gnome.SessionManager.Logout "uint32:1"
}

